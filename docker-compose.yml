# docker-compose.yml
services:
    db:
        image: postgres:latest #(1)
        env_file: .env #(2)
        ports: #(3)
            - 5432:5432
        volumes: #(4)
           - pgdata:/var/lib/postgresql/data

    broker:
        image: "rabbitmq:3.8.18-management"
        container_name: broker
        ports:
        - "5672:5672"
        - "15672:15672"
        environment:
        - RABBITMQ_DEFAULT_USER=guest
        - RABBITMQ_DEFAULT_PASS=guest

    lfg-api:
        build:
            context:  ./services/lfg_bank
            target: DevService 
        container_name:  lfg-api
        env_file:  ./services/lfg_bank/.env #(3)
        command: /code/entrypoint.sh
        volumes: #(4)
            - ./services/lfg_bank:/code
        stdin_open: true #(9)
        tty: true #(10)
        ports: #(3)
            - 8000:8000
        depends_on: #(8)
            - db
            - flower
            - broker


    flower:
        image: mher/flower
        container_name: flower
        environment:
            - FLOWER_PORT=5555
            - CELERY_BROKER_URL=pyamqp://guest:guest@broker//
        ports:
            - "5555:5555"
        depends_on:
            - broker

volumes: #(4)
    pgdata: